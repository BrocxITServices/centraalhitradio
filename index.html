<!DOCTYPE HTML>
<!--
	Directive by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Directive by HTML5 UP</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body class="is-preload">

		<!-- Header -->
			<div id="header">
				<h1 style="display: none;">Centraal Hitradio</h1>
				<div>
					<img style="max-width: 300px; margin-left: 1px;" title="centraal hitradio logo" src="images/logo-transparent-short.png" />

					<p>Welkom bij Centraal Hitradio! Jouw lokale geluid, 24/7. <br/> Muziek, nieuws & gezelligheid, direct uit de buurt.</p>
					<div style="margin-top: 20px;">
						<canvas id="audio-visualizer"></canvas>
					</div>
					<div style="margin-top: 25px;">
						<audio id="audio-source" crossOrigin="anonymous" controls autoplay="">
							<source src="https://stream-10.pmteurope.com:8020/stream" type="audio/mpeg">Your browser does not support the audio element.
						</audio>
					</div>
				</div>

					<div class="now-playing-container">
						<div id="now-playing-art">
							<img src="https://placehold.co/58x58"/>
						</div>
						<div id="now-playing-text">
							<span></span>
						</div>
					</div>
				<!-- <span class="logo icon fa-paper-plane"></span> -->
			</div>

		<!-- Main -->
			<div id="main">
				<header class="major container medium">
					<div class="nextup-container">
						<h2 style="color:#13519c">
							Volgende
						</h2>
						<div class="playing-container">
							<div class="playing-row-container">
								<div id="nextup-art">
									<img style="max-width: 80px;" src="https://placehold.co/58x58"/>
								</div>
								<div id="nextup-text">
									<span></span>
								</div>
							</div>
						</div>
					</div>
					<div class="history-container" style="margin-top: 35px;">
						<h2 style="color:#13519c">
							Geschiedenis
						</h2>
						<div class="playing-container">
							<div class="playing-row-container">
								<div id="history-art-0">
									<img style="max-width: 80px;" src=""/>
								</div>
								<div id="history-text-0">
									<span></span>
								</div>
							</div>
							<div class="playing-row-container">
								<div id="history-art-1">
									<img style="max-width: 80px;" src=""/>
								</div>
								<div id="history-text-1">
									<span></span>
								</div>
							</div>
							<div class="playing-row-container">
								<div id="history-art-2">
									<img style="max-width: 80px;" src=""/>
								</div>
								<div id="history-text-2">
									<span></span>
								</div>
							</div>
						</div>
					</div>
				</header>

				<h3 style="color:#13519c">
					Chat mee
				</h3>
				<div class="row" style="margin-left: 25px; margin-right: 25px;">
					<div class="col-12">
						<script src="https://minnit.chat/js/embed.js?c=1740011833" defer></script>
						<span style="display: none;" class="minnit-chat-sembed" data-chatname="https://organizations.minnit.chat/861709518060891/Main?embed" data-style="width:100%; height:500px; max-height:90vh;">Chat</span>
					</div>
				</div>

				<div class="box alt container" style="margin-top: 25px;">
					<section class="feature left">
						<a href="javascript:void(0)" class="image icon solid fa-level-up-alt" style="cursor: default;"><img src="images/pic01.jpg" alt="" /></a>
						<div class="content">
							<h3 style="color:#13519c">Kwaliteit streaming</h3>
							<p>Zo helder (<i>320kbps</i>), je hoort bijna de snaren trillen. Geen gekraak, w√©l gekke hits.</p>
						</div>
					</section>
					<section class="feature right">
						<a href="javascript:void(0)" class="image icon solid fa-digital-tachograph" style="cursor: default;"><img src="images/pic02.jpg" alt="" /></a>
						<div class="content">
							<h3 style="color:#13519c">Volledig digitaal</h3>
							<p>Geen antennes op het dak of geklooi met frequenties. Gewoon klikken en knallen.</p>
						</div>
					</section>
					<section class="feature left">
						<a href="javascript:void(0)" class="image icon solid fa-map-pin" style="cursor: default;"><img src="images/pic03.jpg" alt="" /></a>
						<div class="content">
							<h3 style="color:#13519c">Altijd in de buurt</h3>
							<p>Vanuit de buurt, voor de buurt. Geen AI-stem, maar echte stemmen met koffie en koekjes.</p>
						</div>
					</section>
				</div>
				
				<footer class="major container medium" style="display: none;">
					<!-- <h3>Vraag een nummertje aan</h3>
					<span class="logo icon fa-paper-plane"></span>
					<p>Vitae natoque dictum etiam semper magnis enim feugiat amet curabitur tempor orci penatibus. Tellus erat mauris ipsum fermentum etiam vivamus.</p>
					<ul class="actions special">
						<li><a href="#" class="button">Join our crew</a></li>
					</ul> -->

					
					<!-- <div class="row">
						<div class="col-12">
							<h3>Vraag een nummertje aan</h3>
						</div>
						<div class="col-12">
							<a href="javascript:console.log('yeah')">
								<img src="images/whatsapp-50.png"/>
							</a>
						</div>
					</div> -->
				</footer>

			</div>

		<!-- Footer -->
			<div id="footer">
				<div class="container medium">

					<!-- <header class="major last">
						<h2>Questions or comments?</h2>
					</header>

					<p>Vitae natoque dictum etiam semper magnis enim feugiat amet curabitur tempor
					orci penatibus. Tellus erat mauris ipsum fermentum etiam vivamus.</p> -->

					<ul class="icons">
						<li>
							<img style="width: 85px;" src="images/sena_logo.svg"><br/>81204761
						</li>
						<li>
							<img style="width: 85px;" src="images/buma_logo.svg"><br/>81204761
						</li>
					</ul>

					<ul class="copyright">
						<li>&copy; Centraal Hitradio. All rights reserved.</li>
						<li>Design: <a href="http://html5up.net" target="_blank">HTML5 UP</a></li>
						<li>Modified by <a href="https://jeffrey.brocx.io" target="_blank">Jeffrey Brocx</a></li>
					</ul>

				</div>
			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="assets/js/audio-visualizer-bundle.js">
				// https://github.com/foobar404/Wave.js
				// From https://cdn.jsdelivr.net/gh/foobar404/wave.js/dist/bundle.js
			</script>
			<script>
				const debug = false;
				const azuraCastApiUrlWSS = "https://demo.azuracast.com/api/live/nowplaying/websocket";
				//const azuraCastApiUrl = "https://demo.azuracast.com/api/nowplaying_static/azuratest_radio.json";

				document.addEventListener("DOMContentLoaded", (e) => {
					let audioElement = document.querySelector("#audio-source");
					let canvasElement = document.querySelector("#audio-visualizer");
					let wave = new Wave(audioElement, canvasElement);

					// Simple example: add an animation
					//wave.addAnimation(new wave.animations.Wave());

					// Intermediate example: add an animation with options
					wave.addAnimation(new wave.animations.Arcs({
						count: 15,
						lineColor: "#13519c",
						fillColor: "#13519c",
						//lineWidth: 1,
						diameter: 55,
						frequencyBand: "mids"
					}));

					handleWebsocketConnection()
				});

				// async function updateNowPlaying(){
				// 	const url = "https://demo.azuracast.com/api/nowplaying_static/azuratest_radio.json";
				// 	try {
				// 		const response = await fetch(url);
				// 		if (!response.ok) {
				// 			throw new Error(`Response status: ${response.status}`);
				// 		}

				// 		const json = await response.json();
				// 		console.log(json);

				// 		document.querySelector('#now-playing-text span').innerHTML = json.now_playing?.song?.text;
				// 		document.querySelector('#now-playing-art img').src = json.now_playing?.song?.art;
						
				// 	} catch (error) {
				// 		console.error(error.message);
				// 	}
				// }

				function handleWebsocketConnection(){
					let socket = new WebSocket(azuraCastApiUrlWSS);

					socket.onopen = function (e) {
						if(debug) console.warn("WebSocket geopend:", e);

						socket.send(JSON.stringify({
							subs: {
								"station:azuratest_radio": { recover: true }
							}
						}));
					};

					let nowplaying = {};
					let currentTime = 0;

					// Handle a now-playing event from a station
					function handleSseData(ssePayload, useTime = true) {
							const jsonData = ssePayload.data;

							if(debug) console.warn("Ontvangen now-playing data:", jsonData);

							if (useTime && 'current_time' in jsonData) {
								currentTime = jsonData.current_time;
								if(debug) console.warn("Bijgewerkte currentTime:", currentTime);
							}

							nowplaying = jsonData.np;

							// Update UI
							document.querySelector('#now-playing-text span').innerHTML = jsonData.np.now_playing?.song?.text;
							document.querySelector('#now-playing-art img').src = jsonData.np.now_playing?.song?.art;

							document.querySelector('#nextup-text span').innerHTML = jsonData.np.playing_next?.song?.text;
							document.querySelector('#nextup-art img').src = jsonData.np.playing_next?.song?.art;
							
							const history = jsonData.np.song_history.slice(0, 3);
							for (let index = 0; index < history.length; index++) {
								document.querySelector('#history-text-' + index + ' span').innerHTML = history[index].song?.text;
								document.querySelector('#history-art-' + index + ' img').src = history[index].song?.art;
							}
					}

					socket.onmessage = function (e) {
						const jsonData = JSON.parse(e.data);
						if(debug) console.warn("Ontvangen WebSocket bericht:", jsonData);

						if ('connect' in jsonData) {
							const connectData = jsonData.connect;

							if ('data' in connectData) {
								// Legacy SSE data
								if(debug) console.warn("Legacy SSE connectData ontvangen");
								connectData.data.forEach((initialRow) => handleSseData(initialRow));
							} else {
								// Nieuw Centrifugo-formaat
								if ('time' in connectData) {
									currentTime = Math.floor(connectData.time / 1000);
									if(debug) console.warn("Centrifugo timestamp ontvangen:", currentTime);
								}

								for (const subName in connectData.subs) {
									const sub = connectData.subs[subName];
									if ('publications' in sub && Array.isArray(sub.publications)) {
										sub.publications.forEach((initialRow) => handleSseData(initialRow, false));
									}
								}
							}

						} else if ('pub' in jsonData) {
							if(debug) console.warn("Publicatie-update ontvangen");
							handleSseData(jsonData.pub);
						}
					};

				}
			</script>
	</body>
</html>